<!-- modal.html - Modal Dialog component
#    Copyright (C) 2026  Aaron Reichenbach
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as published
#    by the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.
#
#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>. -->

{% macro render(id, data, classes=[]) %}
{# ADDED: Check for 'open' class and add the 'open' attribute to the dialog tag #}
<dialog id="{{ id }}" class="modal {{ classes|join(' ') }}" {% if 'open' in classes %}open{% endif %}>
    <div class="modal-content">
        <header>
            <h2>{{ data.title }}</h2>
            
            {# ADDED: Support for link-based closing (Server-Side State) #}
            {% if data.close_href %}
                <a href="{{ data.close_href }}" class="btn-close" aria-label="Close">&times;</a>
            {% else %}
                {# Fallback for JS-based closing #}
                <form method="dialog">
                    <button class="btn-close" aria-label="Close">&times;</button>
                </form>
            {% endif %}
        </header>
        
        <div class="modal-body">
            {% if data.details %}
            <dl class="details-grid">
                {% for item in data.details %}
                <dt>{{ item.key }}</dt>
                <dd>{{ item.value }}</dd>
                {% endfor %}
            </dl>
            {% endif %}

            {% if data.content %}
            <div class="custom-content">
                {{ data.content | safe }}
            </div>
            {% endif %}
        </div>

        {% if data.actions %}
        <footer>
            <div class="action-group">
                {% for action in data.actions %}
                {# Support for links vs buttons in footer #}
                {% if action.href %}
                    <a href="{{ action.href }}" class="btn {{ action.class }}">{{ action.label }}</a>
                {% else %}
                    <button type="{{ action.type|default('button') }}" class="btn {{ action.class }}">{{ action.label }}</button>
                {% endif %}
                {% endfor %}
            </div>
        </footer>
        {% endif %}
    </div>
</dialog>
{% endmacro %}