<!-- admin_announce.html - Admin panel subcontent for announcements management
Copyright (C) 2026 Aaron Reichenbach

This program is free software: you can redistribute it and/or modify         
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.-->

{% extends 'admin.html' %}
{% import "components/panel.html" as Panel %}
{% import "components/form.html" as Form %}
{% import "components/table.html" as Table %}

{% block subcontent %}

    {% set list_footer %}
        <div class="panel-meta">
            [Records: {{ pagination.total_records }}]
            
            {% if pagination.has_prev %}
                <a href="{{ pagination.prev_href }}">[prev]</a>
            {% else %}
                <span class="text-muted">[prev]</span>
            {% endif %}

            {{ pagination.page }} / {{ pagination.pages }}

            {% if pagination.has_next %}
                <a href="{{ pagination.next_href }}">[next]</a>
            {% else %}
                <span class="text-muted">[next]</span>
            {% endif %}
        </div>
    {% endset %}

    {% call Panel.render(
        type='article',
        header={'title': 'Archive', 'subtitle': 'History'},
        footer=list_footer,
        classes=['margin-top-l'] 
    ) %}
        {{ Table.render(columns, rows, classes=['table-data']) }}
    {% endcall %}

    
    
    {% set form_data = {
        'id': 'announce-form',
        'action': url_for('admin.announce'),
        'method': 'POST',
        'fields': [
            {'name': 'title', 'label': 'title', 'type': 'text', 'width': 'full-width', 'placeholder': 'Enter title', 'value': edit_data.title if edit_data else ''},
            {'name': 'subtitle', 'label': 'subtitle', 'type': 'text', 'width': 'full-width', 'placeholder': 'Enter subtitle (optional)', 'value': edit_data.subtitle if edit_data else ''},
            {'name': 'content', 'label': 'content', 'type': 'textarea', 'width': 'full-width', 'height': 'height-large', 'placeholder': 'Enter announcement content...', 'value': edit_data.content if edit_data else ''},
            {'name': 'footnote', 'label': 'footnote', 'type': 'text', 'width': 'full-width', 'placeholder': 'Enter footnote (optional)', 'value': edit_data.footnote if edit_data else ''}
        ],
        'buttons': [
            {'label': 'update announcement' if edit_data else 'create announcement', 'type': 'submit', 'class': 'inverted'}
        ]
    } %}

    {# If editing, we need to pass the ID back so the backend knows to update #}
    {% if edit_data %}
        {% set _ = form_data.fields.insert(0, {'name': 'edit_id', 'type': 'hidden', 'value': edit_data.id}) %}
    {% endif %}

    {% set editor_footer %}
        {{ Form.render_actions(form_data) }}
    {% endset %}

    {% call Panel.render(
        type='article',
        header={'title': 'Editor', 'subtitle': 'Edit ID: ' ~ edit_data.id if edit_data else 'Create New'},
        footer=editor_footer
    ) %}
        {{ Form.render(form_data) }}
    {% endcall %}

{% endblock %}